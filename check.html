<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cookie Support Checker - Main Site</title>
    <style>
        .result {
            margin: 20px;
            padding: 10px;
            border: 1px solid #ccc;
        }
        .supported {
            background-color: #e6ffe6;
            border-color: #00cc00;
        }
        .not-supported {
            background-color: #ffe6e6;
            border-color: #cc0000;
        }
        button {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>Third-Party Cookie Support Checker</h1>
    <button onclick="checkCookieSupport()">Check Cookie Support</button>
    <div id="result" class="result"></div>

    <script>
        function checkThirdPartyCookieSupport() {
            return new Promise((resolve) => {
                const iframe = document.createElement('iframe');
                iframe.style.display = 'none';
                // Replace with your actual third-party domain
                iframe.src = 'https://qlikwebisr.github.io/third-cookie-check/index.html';
                
                let timeoutId;
                
                const cleanup = () => {
                    clearTimeout(timeoutId);
                    document.body.removeChild(iframe);
                };

                const handleMessage = (event) => {
                    // Make sure to update this to match your third-party domain
                    if (event.origin === 'https://qlikwebisr.github.io/third-cookie-check') {
                        cleanup();
                        window.removeEventListener('message', handleMessage);
                        resolve(event.data.cookiesSupported);
                    }
                };

                window.addEventListener('message', handleMessage);

                timeoutId = setTimeout(() => {
                    cleanup();
                    window.removeEventListener('message', handleMessage);
                    resolve(false);
                }, 5000);

                document.body.appendChild(iframe);
            });
        }

        async function checkCookieSupport() {
            const resultDiv = document.getElementById('result');
            resultDiv.className = 'result';
            resultDiv.textContent = 'Checking cookie support...';

            try {
                const supported = await checkThirdPartyCookieSupport();
                resultDiv.textContent = supported ? 
                    '✅ Third-party cookies are supported' : 
                    '❌ Third-party cookies are blocked';
                resultDiv.classList.add(supported ? 'supported' : 'not-supported');
            } catch (error) {
                resultDiv.textContent = '❌ Error checking cookie support: ' + error.message;
                resultDiv.classList.add('not-supported');
            }
        }
    </script>
</body>
</html>